FROM node:16-alpine
WORKDIR /oath

RUN mkdir -p /oath/web
RUN mkdir -p /oath/shared

RUN npm install -g pnpm

COPY ./web/pnpm-lock.yaml /oath/web
RUN cd web && pnpm fetch
COPY ./web /oath/web
COPY ./shared /oath/shared
RUN cd web && pnpm install --offline

WORKDIR /oath/web
CMD [ "pnpm", "run", "dev" ]