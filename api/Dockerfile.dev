FROM node:16-alpine
WORKDIR /id

RUN mkdir -p /id/api
RUN mkdir -p /id/shared

RUN npm install -g pnpm

COPY ./api/pnpm-lock.yaml /id/api
RUN cd api && pnpm fetch
COPY ./api /id/api
COPY ./shared /id/shared
RUN cd api && pnpm install --offline

WORKDIR /id/api
CMD [ "pnpm", "run", "dev" ]